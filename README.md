# PureScript Nix output

A small demonstration of how simple it is to build PureScript projects with Nix.

Put another way, how easy it is to build the *PureScript* part of your project, not the other parts.

## How

First, we let Psc-Package2Nix do all the dependency work:

```
pp2n psc-package2nix
wrote packages.nix
```

We can see it produces an expression with the various packages, with a `inputs` set ("record") of our packages.

We can use this to build our derivation for this project:

```nix
{ pkgs ? import <nixpkgs> {} }:

let
  pp2n = import (...);
  easy-ps = import (...);

  # import packages
  packages = import ./packages.nix { inherit pkgs; };

  # prepare quoted globs for the PureScript compiler
  getGlob = pkg: ''"${pkg}/src/**/*.purs"'';

  # map on the set's attribute values (the packages)
  # then toString the result
  globs = with builtins; toString (map getGlob (attrValues packages.inputs));

in pkgs.stdenv.mkDerivation {
  name = "purescript-nix-output-demo";
  src = ./.;

  installPhase = ''
    # run the PureScript compiler with the globs, and with files in src
    ${easy-ps.purs}/bin/purs compile ${globs} "src/**/*.purs"
    mkdir -p $out
    mv output $out
  '';
}
```

You can use `./run` and see the results:

```bash
echo "Contents of ./result/output/Main/index.js:"
cat ./result/output/Main/index.js

node -e "require('./result/output/Main').main()"
```

```js
Contents of ./result/output/Main/index.js:
// Generated by purs version 0.12.3
"use strict";
var Effect = require("../Effect/index.js");
var Effect_Console = require("../Effect.Console/index.js");
var Prelude = require("../Prelude/index.js");
var main = Effect_Console.log("Hello World");
module.exports = {
    main: main
};
Hello World
```
